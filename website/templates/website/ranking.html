{% extends 'website/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

<section>
  <div class='container'>

    <h1>Algorithm</h1>
    <h3>I know my city and my specialty</h3>
    <p>I want to work as </p>
    <form>
      <select id='select_specialty'>
        <option>--------------</option>
        <option>Ophtalmology</option>
        {% for specialty in specialties %}
        <option>{{ specialty.name }}</option>
        {% endfor %}
      </select>
      <p>in </p>
      <select id='select_city'>
        <option>--------------</option>
        <option>Cluj-Napoca</option>
        <option>Bucharest</option>
        <option>Alba Iulia</option>
      </select>
      <button id='getgrade' type='submit'>OK</button>
    </form>
    <p>You minimum grade is: <div id='grade'></div>
    </p>

    <h3>I know my city and my grade</h3>
    <p>I want to work in </p>
    <form>
      <select id='select_city2'>
        <option>--------------</option>
        <option>Cluj-Napoca</option>
        <option>Bucharest</option>
        <option>Alba Iulia</option>
      </select>
      <p>and I think my grade will be around</p>
      <input id='select_grade'></input>
      <button id='getspecialty' type='submit'>OK</button>
    </form>
    <p>You will be able to work as a: <div id='specialty'></div>
    </p>

    <h3>I know my specialty and my grade</h3>
    <p>I want to work as a </p>
    <form>
      <select id='select_specialty2'>
        <option>--------------</option>
        <option>Ophtalmology</option>
        <option>Surgery</option>
        {% for specialty in specialties %}
        <option>{{ specialty.name }}</option>
        {% endfor %}
      </select>
      <p>and I think my grade will be around</p>
      <input id='select_grade2'></input>
      <button id='getcity' type='submit'>OK</button>
    </form>
    <p>You will be able to work in: <div id='city'></div>
    </p>


    <div class="row">

    </div>

    <h1 class='mb-5'>Rankings</h1>
    <div class="row justify-content-center">

      <form method='get' style='width:80%' class="form-inline mb-5">
        {% for field in myFilter.form %}
        <div class='col-3'>
          <div class='row justify-content-center'>{{field.name|upper}}</div>
          <div class='row justify-content-center'>{{field}}</div>
        </div>
        {% endfor %}
        <button id='filterbutton' type="submit" class="btn btn-primary my-1">Submit</button>
      </form>
    </div>

    <div class='row'>
      <table id='mytable' class="table table-hover">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">First Name</th>
            <th scope="col">Last Name</th>
            <th scope="col">Grade</th>
            <th scope="col">Choice</th>
            <th scope="col">Location</th>
            <th scope="col">Year</th>
          </tr>
        </thead>
        <tbody>
          {% for candidate in candidates %}
          <tr>
            <th scope="row">{{ candidate.id }}</th>
            <td>{{ candidate.first_name }}</td>
            <td>{{ candidate.family_name }}</td>
            <td>{{ candidate.grade }}</td>
            <td>{{ candidate.choice }}</td>
            <td>{{ candidate.location }}</td>
            <td>{{ candidate.year }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>



<script src="{% static 'website/vendor/jquery/jquery.min.js' %}"></script>
<script>
  $("#getgrade").click(function (e) {
    e.preventDefault();
    var specialty = document.getElementById('select_specialty').value;
    var city = document.getElementById('select_city').value;
    $.ajax({
      url: '{% url "get_grade" %}', // La ressource ciblée
      data: {
        'specialty': specialty,
        'city': city,
      },
      success: function (result) {
        document.getElementById('grade').textContent = result;
        console.log(result)
      }
    });
  });

  $("#getspecialty").click(function (e) {
    e.preventDefault();
    var grade = document.getElementById('select_grade').value;
    var city = document.getElementById('select_city2').value;
    $.ajax({
      url: '{% url "get_specialty" %}', // La ressource ciblée
      data: {
        'grade': grade,
        'city': city,
      },
      success: function (result) {
        document.getElementById('specialty').textContent = result;
        console.log(result);
      }
    });
  });

  $("#getcity").click(function (e) {
    e.preventDefault();
    var grade = document.getElementById('select_grade2').value;
    var specialty = document.getElementById('select_specialty2').value;
    $.ajax({
      url: '{% url "get_city" %}', // La ressource ciblée
      data: {
        'grade': grade,
        'specialty': specialty,
      },
      success: function (result) {
        document.getElementById('city').textContent = result;
        console.log(result);
      }
    });
  });

</script>

{% endblock %}